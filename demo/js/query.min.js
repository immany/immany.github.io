var tableData=[{"column 1":"value 11","column 2":"value 12"},{"column 1":"value 21","column 2":"value 22"}],table=new Tabulator("#table-res",{layout:"fitColumns",responsiveLayout:!0,autoColumns:!0,pagination:"local",paginationSize:15,clipboard:!0});table.setData(tableData),table.redraw();var queryData=[{id:"0",desc:"How many product views do we have on a daily basis?",displayGraph:!0,query:"select date_format( timestamp , 'yyyy-MM-dd') AS Day, count(*) AS productViews from   emea_ee_dataset_api where  _experienceplatform.brand.brandName like 'Luma Telco' and _experienceplatform.productData.productInteraction = 'productView' group by Day limit 10;",results:[{day:"2019-09-12",productViews:4304},{day:"2019-08-19",productViews:2225},{day:"2019-10-09",productViews:1955},{day:"2019-10-02",productViews:2430},{day:"2019-10-25",productViews:2170},{day:"2019-09-20",productViews:2640},{day:"2019-07-19",productViews:3400},{day:"2019-06-16",productViews:2260},{day:"2019-10-08",productViews:2400},{day:"2019-08-17",productViews:3350}]},{id:"1",desc:"What are the top 5 products viewed?",displayGraph:!0,query:"select _experienceplatform.productData.productName, count(*) from emea_ee_dataset_api where _experienceplatform.brand.brandName like 'Luma Telco' and    _experienceplatform.productData.productInteraction = 'productView' group  by _experienceplatform.productData.productName order  by 2 desc limit 5;",results:[{productName:"Google Pixel XL 32GB Black Smartphone",count:871},{productName:"Samsung Galaxy S7 32GB Black",count:482},{productName:"Samsung Galaxy S8",count:457},{productName:"SIM Only",count:450}]},{id:"2",desc:"Product Interaction funnel, from viewing to buying",displayGraph:!0,query:"select _experienceplatform.productData.productInteraction, count(*) from emea_ee_dataset_api where _experienceplatform.brand.brandName like 'Luma Telco' and _experienceplatform.productData.productInteraction is not null group  by _experienceplatform.productData.productInteraction;",results:[{productInteraction:"productView",count:"2260"},{productInteraction:"productAddToCart",count:"554"},{productInteraction:"productPurchase",count:"251"}]},{id:"3",desc:"Identify visitors with risk to Churn (visit page => Cancel Service)",displayGraph:!1,query:"select distinct _experienceplatform.identification.ecid from emea_ee_dataset_api where _experienceplatform.brand.brandName like 'Luma Telco' and web.webPageDetails.name = 'Cancel Service' group by _experienceplatform.identification.ecid limit 10;",results:[{ecid:"16840282692567409512738085083124"},{ecid:"61078464596244340558263746344113"},{ecid:"67550254189152640330673862781287"},{ecid:"41960120232527468228415511964616"},{ecid:"89687328800348208661758433679450"},{ecid:"88878080294969230463386902460350"},{ecid:"16446318267724026061153928852297"},{ecid:"05129335423558173081574046306667"},{ecid:"30954842187077349630489483172285"},{ecid:"67303048231925605487990717711467"}]},{id:"4",desc:"What do people do on the site before reaching the 'Cancel Service' page as the 3rd page in a session?",displayGraph:!1,query:"SELECT webPage, webPage_2, webPage_3, webPage_4, count(*) journeys FROM ( SELECT webPage, NEXT(webPage, 1, true) OVER(PARTITION BY ecid, session.num ORDER BY timestamp ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING).value AS webPage_2, NEXT(webPage, 2, true) OVER(PARTITION BY ecid, session.num ORDER BY timestamp ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING).value AS webPage_3, NEXT(webPage, 3, true) OVER(PARTITION BY ecid, session.num ORDER BY timestamp ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING).value AS webPage_4, session.depth AS SessionPageDepth FROM ( select a._experienceplatform.identification.ecid as ecid, a.timestamp, web.webPageDetails.name as webPage, SESS_TIMEOUT(timestamp, 60 * 30) OVER (PARTITION BY a._experienceplatform.identification.ecid ORDER BY timestamp ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS session from emea_ee_dataset_api a where a._experienceplatform.identification.ecid in ( select b._experienceplatform.identification.ecid from emea_ee_dataset_api b where b._experienceplatform.brand.brandName like 'Luma Telco' and b.web.webPageDetails.name = 'Cancel Service' ) ) ) WHERE SessionPageDepth=1 and webpage_3 = 'Cancel Service' GROUP BY webPage, webPage_2, webPage_3, webPage_4 ORDER BY journeys DESC LIMIT 10;",results:[{webPage:"Broadband Deals",webPage_2:"BT Sport",webPage_3:"Cancel Service",webPage_4:"",journeys:"2"},{webPage:"Samsung Galaxy S7 32GB Black",webPage_2:"Telco Home",webPage_3:"Cancel Service",webPage_4:"Call Start",journeys:"2"},{webPage:"BT Sport",webPage_2:" Broadband Deals",webPage_3:"Cancel Service",webPage_4:"",journeys:"2"},{webPage:"Samsung Galaxy S8",webPage_2:"Samsung Galaxy S7 32GB Black",webPage_3:"Cancel Service",webPage_4:"",journeys:"2"},{webPage:"SIM Only",webPage_2:"BT Sport",webPage_3:"Cancel Service",webPage_4:"",journeys:"2"},{webPage:"Samsung Galaxy S8",webPage_2:"Google Pixel XL 32GB Black Smartphone",webPage_3:"Cancel Service",webPage_4:"",journeys:"2"},{webPage:"Google Pixel XL 32GB Black Smartphone",webPage_2:"Google Pixel XL 32GB Black Smartphone",webPage_3:"Cancel Service",webPage_4:"Call Start",journeys:"1"},{webPage:"Telco Home",webPage_2:"BT Sport",webPage_3:"Cancel Service",webPage_4:"",journeys:"1"},{webPage:"Samsung Galaxy S7 32GB Black",webPage_2:"Samsung Galaxy S7 32GB Black",webPage_3:"Cancel Service",webPage_4:"",journeys:"1"},{webPage:"Telco Home",webPage_2:"SIM Only",webPage_3:"Cancel Service",webPage_4:"Call Start",journeys:"1"}]},{id:"5",desc:"How much time do we have before a visitor calls the call center after visiting the 'Cancel Service' Page?",displayGraph:!1,query:"select * from ( select _experienceplatform.identification.ecid as ecid, web.webPageDetails.name as webPage, TIME_BETWEEN_NEXT_MATCH(timestamp, web.webPageDetails.name='Call Start', 'seconds') OVER(PARTITION BY _experienceplatform.identification.ecid ORDER BY timestamp ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING) AS contact_callcenter_after_seconds from emea_ee_dataset_api where _experienceplatform.brand.brandName like 'Luma Telco' and web.webPageDetails.name in ('Cancel Service', 'Call Start') ) r where r.webPage = 'Cancel Service' limit 15;",results:[{ecid:" 16840282692567409512738085083124",webPage:"Cancel Service",contact_callcenter_after_seconds:-682},{ecid:" 61078464596244340558263746344113",webPage:"Cancel Service",contact_callcenter_after_seconds:-992},{ecid:" 67550254189152640330673862781287",webPage:"Cancel Service",contact_callcenter_after_seconds:""},{ecid:" 41960120232527468228415511964616",webPage:"Cancel Service",contact_callcenter_after_seconds:-413},{ecid:" 89687328800348208661758433679450",webPage:"Cancel Service",contact_callcenter_after_seconds:-660},{ecid:" 88878080294969230463386902460350",webPage:"Cancel Service",contact_callcenter_after_seconds:""},{ecid:" 16446318267724026061153928852297",webPage:"Cancel Service",contact_callcenter_after_seconds:""},{ecid:" 05129335423558173081574046306667",webPage:"Cancel Service",contact_callcenter_after_seconds:-338},{ecid:" 30954842187077349630489483172285",webPage:"Cancel Service",contact_callcenter_after_seconds:""},{ecid:" 67303048231925605487990717711467",webPage:"Cancel Service",contact_callcenter_after_seconds:""},{ecid:" 46287808668627830610738182996314",webPage:"Cancel Service",contact_callcenter_after_seconds:""},{ecid:" 51445169960384754128107207557090",webPage:"Cancel Service",contact_callcenter_after_seconds:""},{ecid:" 27152426490361339828046162469720",webPage:"Cancel Service",contact_callcenter_after_seconds:-233},{ecid:" 99710552953080861204321940836318",webPage:"Cancel Service",contact_callcenter_after_seconds:""},{ecid:" 64912713120337228765590984621892",webPage:"Cancel Service",contact_callcenter_after_seconds:-921}]},{id:"6",desc:"What is the outcome of that contact?",displayGraph:!1,query:"select r.*, c._experienceplatform.callDetails.callFeeling, c._experienceplatform.callDetails.callTopic, c._experienceplatform.callDetails.contractCancelled from ( select _experienceplatform.identification.ecid ecid, web.webPageDetails.name as webPage, TIME_BETWEEN_NEXT_MATCH(timestamp, web.webPageDetails.name='Call Start', 'seconds') OVER(PARTITION BY _experienceplatform.identification.ecid ORDER BY timestamp ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING) AS contact_callcenter_after_seconds from emea_ee_dataset_api where _experienceplatform.brand.brandName like 'Luma Telco' and web.webPageDetails.name in ('Cancel Service', 'Call Start') ) r , emea_call_center_interactions c where r.ecid = c._experienceplatform.identification.ecid and r.webPage = 'Cancel Service' limit 15;",results:[{ecid:" 16840282692567409512738085083124"," webPage":" Cancel Service"," contact_callcenter_after_seconds":-682," callfeeling":" positive"," calltopic":" contract"," contractcancelled ":!1},{ecid:" 61078464596244340558263746344113"," webPage":" Cancel Service"," contact_callcenter_after_seconds":-992," callfeeling":" negative"," calltopic":" contract"," contractcancelled ":!1},{ecid:" 67550254189152640330673862781287"," webPage":" Cancel Service"," contact_callcenter_after_seconds":""," callfeeling":" none"," calltopic":" none"," contractcancelled ":!1},{ecid:" 41960120232527468228415511964616"," webPage":" Cancel Service"," contact_callcenter_after_seconds":-413," callfeeling":" negative"," calltopic":" contract"," contractcancelled ":!1},{ecid:" 89687328800348208661758433679450"," webPage":" Cancel Service"," contact_callcenter_after_seconds":-660," callfeeling":" neutral "," calltopic":" contract"," contractcancelled ":!1},{ecid:" 88878080294969230463386902460350"," webPage":" Cancel Service"," contact_callcenter_after_seconds":""," callfeeling":" none"," calltopic":" none"," contractcancelled ":!1},{ecid:" 16446318267724026061153928852297"," webPage":" Cancel Service"," contact_callcenter_after_seconds":""," callfeeling":" none"," calltopic":" none"," contractcancelled ":!1},{ecid:" 05129335423558173081574046306667"," webPage":" Cancel Service"," contact_callcenter_after_seconds":-338," callfeeling":" positive"," calltopic":" contract"," contractcancelled ":!1},{ecid:" 30954842187077349630489483172285"," webPage":" Cancel Service"," contact_callcenter_after_seconds":""," callfeeling":" none"," calltopic":" none"," contractcancelled ":!1},{ecid:" 67303048231925605487990717711467"," webPage":" Cancel Service"," contact_callcenter_after_seconds":""," callfeeling":" none"," calltopic":" none"," contractcancelled ":!1},{ecid:" 46287808668627830610738182996314"," webPage":" Cancel Service"," contact_callcenter_after_seconds":""," callfeeling":" none"," calltopic":" none"," contractcancelled ":!1},{ecid:" 51445169960384754128107207557090"," webPage":" Cancel Service"," contact_callcenter_after_seconds":""," callfeeling":" none"," calltopic":" none"," contractcancelled ":!1},{ecid:" 27152426490361339828046162469720"," webPage":" Cancel Service"," contact_callcenter_after_seconds":-233," callfeeling":" positive"," calltopic":" contract"," contractcancelled ":!0},{ecid:" 99710552953080861204321940836318"," webPage":" Cancel Service"," contact_callcenter_after_seconds":""," callfeeling":" none"," calltopic":" none"," contractcancelled ":!1},{ecid:" 64912713120337228765590984621892"," webPage":" Cancel Service"," contact_callcenter_after_seconds":-921," callfeeling":" neutral "," calltopic":" contract"," contractcancelled ":!1}]},{id:"7",desc:"What is the loyalty profile of these customers?",displayGraph:!1,query:"select r.*, c._experienceplatform.callDetails.callFeeling, c._experienceplatform.callDetails.callTopic, l.loyaltystatus, l.crmid from ( select _experienceplatform.identification.ecid ecid, web.webPageDetails.name as webPage, TIME_BETWEEN_NEXT_MATCH(timestamp, web.webPageDetails.name='Call Start', 'seconds') OVER(PARTITION BY _experienceplatform.identification.ecid ORDER BY timestamp ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING) AS contact_callcenter_after_seconds from emea_ee_dataset_api where _experienceplatform.brand.brandName like 'Luma Telco' and web.webPageDetails.name in ('Cancel Service', 'Call Start') ) r , emea_call_center_interactions c , emea_loyalty_data l where r.ecid = c._experienceplatform.identification.ecid and r.webPage = 'Cancel Service' and l.ecid = r.ecid limit 15;",results:[{ecid:" 16840282692567409512738085083124",webPage:"Cancel Service",contact_callcenter_after_seconds:-682,callfeeling:"positive",calltopic:"contract",loyaltystatus:"silver","crmid ":68202008},{ecid:" 61078464596244340558263746344113",webPage:"Cancel Service",contact_callcenter_after_seconds:-992,callfeeling:"negative",calltopic:"contract",loyaltystatus:"bronze","crmid ":543311130},{ecid:" 67550254189152640330673862781287",webPage:"Cancel Service",contact_callcenter_after_seconds:"none",callfeeling:"none",calltopic:"none",loyaltystatus:"silver","crmid ":178911018},{ecid:" 41960120232527468228415511964616",webPage:"Cancel Service",contact_callcenter_after_seconds:-413,callfeeling:"negative",calltopic:"contract",loyaltystatus:"bronze","crmid ":746081747},{ecid:" 89687328800348208661758433679450",webPage:"Cancel Service",contact_callcenter_after_seconds:-660,callfeeling:"neutral",calltopic:"contract",loyaltystatus:"gold","crmid ":957806157},{ecid:" 88878080294969230463386902460350",webPage:"Cancel Service",contact_callcenter_after_seconds:"none",callfeeling:"none",calltopic:"none",loyaltystatus:"silver","crmid ":693411346},{ecid:" 16446318267724026061153928852297",webPage:"Cancel Service",contact_callcenter_after_seconds:"none",callfeeling:"none",calltopic:"none",loyaltystatus:"silver","crmid ":433375784},{ecid:" 05129335423558173081574046306667",webPage:"Cancel Service",contact_callcenter_after_seconds:-338,callfeeling:"positive",calltopic:"contract",loyaltystatus:"bronze","crmid ":271098686},{ecid:" 30954842187077349630489483172285",webPage:"Cancel Service",contact_callcenter_after_seconds:"none",callfeeling:"none",calltopic:"none",loyaltystatus:"gold","crmid ":759695683},{ecid:" 67303048231925605487990717711467",webPage:"Cancel Service",contact_callcenter_after_seconds:"none",callfeeling:"none",calltopic:"none",loyaltystatus:"bronze","crmid ":211072657},{ecid:" 46287808668627830610738182996314",webPage:"Cancel Service",contact_callcenter_after_seconds:"none",callfeeling:"none",calltopic:"none",loyaltystatus:"gold","crmid ":969541622},{ecid:" 51445169960384754128107207557090",webPage:"Cancel Service",contact_callcenter_after_seconds:"none",callfeeling:"none",calltopic:"none",loyaltystatus:"silver","crmid ":623254233},{ecid:" 27152426490361339828046162469720",webPage:"Cancel Service",contact_callcenter_after_seconds:-233,callfeeling:"positive",calltopic:"contract",loyaltystatus:"bronze","crmid ":900906023},{ecid:" 99710552953080861204321940836318",webPage:"Cancel Service",contact_callcenter_after_seconds:"none",callfeeling:"none",calltopic:"none",loyaltystatus:"gold","crmid ":224921451},{ecid:" 64912713120337228765590984621892",webPage:"Cancel Service",contact_callcenter_after_seconds:-921,callfeeling:"neutral",calltopic:"contract",loyaltystatus:"bronze","crmid ":100441117}]},{id:"8",desc:"From what region do the visit us?",displayGraph:!1,query:"select r.ecid, r.city, r.countrycode, r.lat as latitude, r.lon as longitude, r.contact_callcenter_after_seconds as seconds_to_contact_callcenter, c._experienceplatform.callDetails.callFeeling, c._experienceplatform.callDetails.callTopic, c._experienceplatform.callDetails.contractCancelled, l.loyaltystatus, l.crmid from ( select _experienceplatform.identification.ecid ecid, placeContext.geo._schema.latitude lat, placeContext.geo._schema.longitude lon, placeContext.geo.city, placeContext.geo.countryCode, web.webPageDetails.name as webPage, TIME_BETWEEN_NEXT_MATCH(timestamp, web.webPageDetails.name='Call Start', 'seconds') OVER(PARTITION BY _experienceplatform.identification.ecid ORDER BY timestamp ROWS BETWEEN CURRENT ROW AND UNBOUNDED FOLLOWING) AS contact_callcenter_after_seconds from emea_ee_dataset_api where _experienceplatform.brand.brandName like 'Luma Telco' and web.webPageDetails.name in ('Cancel Service', 'Call Start') ) r , emea_call_center_interactions c , emea_loyalty_data l where r.ecid = c._experienceplatform.identification.ecid and r.webPage = 'Cancel Service' and l.ecid = r.ecid limit 15;",results:[{ecid:1.684028269256741e31,city:"Tournai",countrycode:"BE",latitude:50.585206,longitude:3.3300918,seconds_to_contact_callcenter:-682,callfeeling:"positive",calltopic:"contract",contractcancelled:"no",loyaltystatus:"silver",crmid:"068202008"},{ecid:6.107846459624434e31,city:"Bruxelles",countrycode:"BE",latitude:50.7881573,longitude:4.4180065,seconds_to_contact_callcenter:-992,callfeeling:"negative",calltopic:"contract",contractcancelled:"no",loyaltystatus:"bronze",crmid:543311130},{ecid:6.755025418915264e31,city:"Bouillon",countrycode:"BE",latitude:49.8417042,longitude:5.1214901,seconds_to_contact_callcenter:"",callfeeling:"none",calltopic:"none",contractcancelled:"no",loyaltystatus:"silver",crmid:178911018},{ecid:4.196012023252747e31,city:"Ath",countrycode:"BE",latitude:50.6302806,longitude:3.8861843,seconds_to_contact_callcenter:-413,callfeeling:"negative",calltopic:"contract",contractcancelled:"no",loyaltystatus:"bronze",crmid:746081747},{ecid:8.96873288003482e31,city:"Mons",countrycode:"BE",latitude:50.4271996,longitude:3.989666,seconds_to_contact_callcenter:-660,callfeeling:"neutral",calltopic:"contract",contractcancelled:"no",loyaltystatus:"gold",crmid:957806157},{ecid:8.887808029496923e31,city:"Ath",countrycode:"BE",latitude:50.6302806,longitude:3.8861843,seconds_to_contact_callcenter:"",callfeeling:"none",calltopic:"none",contractcancelled:"no",loyaltystatus:"silver",crmid:693411346},{ecid:1.6446318267724025e31,city:"Tournai",countrycode:"BE",latitude:50.59219,longitude:3.4387783,seconds_to_contact_callcenter:"",callfeeling:"none",calltopic:"none",contractcancelled:"no",loyaltystatus:"silver",crmid:433375784},{ecid:"05129335423558173081574046306667",city:"PÃ©ruwelz",countrycode:"BE",latitude:50.5474037,longitude:3.5567339,seconds_to_contact_callcenter:-338,callfeeling:"positive",calltopic:"contract",contractcancelled:"no",loyaltystatus:"bronze",crmid:271098686},{ecid:3.095484218707735e31,city:"Mons",countrycode:"BE",latitude:50.4271996,longitude:3.989666,seconds_to_contact_callcenter:"",callfeeling:"none",calltopic:"none",contractcancelled:"no",loyaltystatus:"gold",crmid:759695683},{ecid:6.730304823192561e31,city:"Mons",countrycode:"BE",latitude:50.4271996,longitude:3.989666,seconds_to_contact_callcenter:"",callfeeling:"none",calltopic:"none",contractcancelled:"no",loyaltystatus:"bronze",crmid:211072657},{ecid:4.628780866862783e31,city:"Bruxelles",countrycode:"BE",latitude:50.7881573,longitude:4.4180065,seconds_to_contact_callcenter:"",callfeeling:"none",calltopic:"none",contractcancelled:"no",loyaltystatus:"gold",crmid:969541622},{ecid:5.144516996038476e31,city:"Charleroi",countrycode:"BE",latitude:50.4315612,longitude:4.4472854,seconds_to_contact_callcenter:"",callfeeling:"none",calltopic:"none",contractcancelled:"no",loyaltystatus:"silver",crmid:623254233},{ecid:2.715242649036134e31,city:"Charleroi",countrycode:"BE",latitude:50.4315612,longitude:4.4472854,seconds_to_contact_callcenter:-233,callfeeling:"positive",calltopic:"contract",contractcancelled:"yes",loyaltystatus:"bronze",crmid:900906023},{ecid:9.971055295308085e31,city:"Bouillon",countrycode:"BE",latitude:49.8417042,longitude:5.1214901,seconds_to_contact_callcenter:"",callfeeling:"none",calltopic:"none",contractcancelled:"no",loyaltystatus:"gold",crmid:224921451},{ecid:6.491271312033723e31,city:"Namur",countrycode:"BE",latitude:50.4198861,longitude:4.9246444,seconds_to_contact_callcenter:-921,callfeeling:"neutral",calltopic:"contract",contractcancelled:"no",loyaltystatus:"bronze",crmid:100441117}]}];function init(){null==localStorage.getItem("showCredentials")&&localStorage.setItem("showCredentials",!0),null==localStorage.getItem("credentialsError")&&localStorage.setItem("credentialsError",!1),null==localStorage.getItem("offlineMode")&&localStorage.setItem("offlineMode",!1),getCredentialsFromLocalStorage(),initOfflineModeInput(),hljs.initHighlightingOnLoad(),refreshLogs(),new ClipboardJS("#copy-query").on("success",function(e){$("#copy-status").text("Copied!"),setTimeout(function(){$("#copy-status").text("")},1500)})}function highlight(){$("pre code").each(function(e,t){hljs.highlightBlock(t)})}function startTimer(e,t){var a,c,l,n=Date.now();function o(){a=e-((Date.now()-n)/1e3|0),c=(c=a/60|0)<10?"0"+c:c,l=(l=a%60|0)<10?"0"+l:l,t.textContent=c+":"+l,a<=0&&(n=Date.now()+1e3)}o(),setInterval(o,1e3)}function logQuery(e){var t=[];null!=sessionStorage.getItem("executionLogs")&&(t=JSON.parse(sessionStorage.getItem("executionLogs"))),e=e.replace(/(\r\n|\n|\r)/gm," ");var a={date:new Date,query:e};t.push(a),sessionStorage.setItem("executionLogs",JSON.stringify(t))}function refreshLogs(){if(null!=sessionStorage.getItem("executionLogs")){var e="",t=JSON.parse(sessionStorage.getItem("executionLogs"));t.reverse(),t.length>0&&(t.forEach(function(t){e+=`${new Date(t.date).toLocaleString()}: ${t.query} \n\n`}),$("#logs").text(e))}}function setFilters(e){$("#filter-field").empty(),$("#filter-field").append("<option></option>");var t=[];if(null!=e&&e.length>0){var a=e[0];for(var c in a)t.push(c),$("#filter-field").append('<option value="'+c+'">'+c+"</option>")}}function updateFilter(){var e="function"==$("#filter-field").val()?customFilter:$("#filter-field").val();"function"==$("#filter-field").val()?($("#filter-type").prop("disabled",!0),$("#filter-value").prop("disabled",!0)):($("#filter-type").prop("disabled",!1),$("#filter-value").prop("disabled",!1)),table.setFilter(e,$("#filter-type").val(),$("#filter-value").val())}function initOfflineModeInput(){var e=$("#offline");"false"==localStorage.getItem("offlineMode")?($(e).prop("checked",!1),localStorage.setItem("offlineMode",!1)):($(e).prop("checked",!0),localStorage.setItem("offlineMode",!0))}function updateOfflineModeInput(){"false"==localStorage.getItem("offlineMode")?($(this).prop("checked",!0),localStorage.setItem("offlineMode",!0),hideGraph()):($(this).prop("checked",!1),localStorage.setItem("offlineMode",!1))}function buildChart(e){switch(e.type){case"pie":new Chart($("#graph-res"),{type:"pie",data:e.data,options:e.options});break;case"line":var t=new Chart($("#graph-res"),{type:"line",data:e.data,options:e.options});console.log(t);break;case"bar":new Chart($("#graph-res"),{type:"bar",data:e.data,options:e.options});break;default:console.log("graph type unknown")}}function generateChartConfig(){var e=parseInt($("#query-example").val()),t=queryData[e].results,a={type:"",data:{labels:[],datasets:[{data:[]}]},options:{}};switch(e){case 0:return a.type="line",a.data.labels=getSeriesFromResults(t,"day"),a.data.datasets[0].data=getSeriesFromResults(t,"productViews"),a.data.datasets[0].borderColor="#2d9d78",a.data.datasets[0].backgroundColor="transparent",a.data.datasets[0].label="Product views on a daily basis",a.options={scales:{yAxes:[{ticks:{beginAtZero:!0}}]}},a;case 1:return a.type="pie",a.data.labels=getSeriesFromResults(t,"productName"),a.data.datasets[0].data=getSeriesFromResults(t,"count"),a.data.datasets[0].backgroundColor=["#3e95cd","#8e5ea2","#3cba9f","#e8c3b9","#c45850"],a.options={legend:{display:!1},title:{display:!0,text:"TOP 5 Products viewed"}},a;case 2:return a.type="pie",a.data.labels=getSeriesFromResults(t,"productInteraction"),a.data.datasets[0].data=getSeriesFromResults(t,"count"),a.data.datasets[0].backgroundColor=["#3e95cd","#8e5ea2","#3cba9f","#e8c3b9","#c45850"],a.options={legend:{display:!1},title:{display:!0,text:"Product Interaction"}},a;default:console.log("no graph associated")}}function getSeriesFromResults(e,t){var a=[];for(i in e)a.push(e[i][t]);return a}function showGraph(){$("#graph-row").show(),$("#graph-res").show()}function hideGraph(){$("#graph-row").hide(),$("#graph-res").hide()}function refreshHTMLTableData(e){table.clearData(),table.setData(e),table.redraw(),setFilters(e),$("#count").text(table.getDataCount())}function executeQuery(){"true"==localStorage.getItem("offlineMode")?getSQLResultsFromLocal():getSQLResultsFromRuntime()}function getSQLResultsFromRuntime(){var e=$("#query").text();e.replace(/(\r\n|\n|\r)/gm," ");var t=JSON.parse(localStorage.getItem("credentials")),a={pgConfig:{host:t.host,port:t.port,dbname:t.database,username:t.username,password:t.password},query:e,output:{format:"json"}},c={url:"https://8whdfaywu8.execute-api.us-east-1.amazonaws.com/dev/getQueryResults",method:"POST",timeout:6e4,headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*","Content-Type":"application/json"},data:JSON.stringify(a),statusCode:{404:function(){Swal.fire({title:"Serverless action endpoint not found",text:"An error occurred while trying to connect to the serverless action.",icon:"error",confirmButtonText:"OK"}),$("#queries-res").hide()},400:function(){Swal.fire({title:"Serverless action error",html:"<br/>An error occurred while processing your request<br/><br/>Please verify your credentials or your query<br/><br/>",icon:"error",confirmButtonText:"OK"}),$("#queries-res").hide()},204:function(){Swal.fire({title:"Connection failed",text:"An error occurred while trying to connect Platform Query Service.",icon:"error",confirmButtonText:"OK"})},502:function(){Swal.fire({title:"Connection failed",text:"The request has been blocked by CORS policy.",icon:"error",confirmButtonText:"OK"})}}};Swal.fire({title:"Executing SQL query",html:"Please wait while we fetch the query results<br/><br/><span id='timer'>00:00</span>",imageUrl:"https://acsdemoaccelerators.s3.amazonaws.com/commons/images/wait_32.gif",imageHeight:40,allowOutsideClick:!1,timer:12e4,showConfirmButton:!1});startTimer(60,document.querySelector("#timer")),$.ajax(c).done(function(t){$("#queries-res").show(),refreshHTMLTableData(t),logQuery(e),refreshLogs(),Swal.close()}).fail(function(){Swal.close(),console.log("API request canceled"),refreshHTMLTableData(tableData)})}function getSQLResultsFromLocal(){Swal.fire({title:"Executing SQL query",text:"Please wait while we fetch the query results",imageUrl:"https://acsdemoaccelerators.s3.amazonaws.com/commons/images/wait_32.gif",imageHeight:40,allowOutsideClick:!1,showConfirmButton:!1});var e=parseInt($("#query-example").val());setTimeout(function(){$("#queries-res").show(),queryData[e].displayGraph?showGraph():hideGraph(),refreshHTMLTableData(queryData[e].results),logQuery(queryData[e].query),refreshLogs(),Swal.close()},2e3)}function showCredentialsPanel(){$("#credentials").show(),$("#queries").hide()}function showQueryPanel(){$("#credentials").hide(),$("#queries").show(),$("#queries-res").hide(),$("#query").text(""),"true"==localStorage.getItem("offlineMode")?($("#query").removeAttr("contenteditable"),showGraph(),$("#grp-query-example").show()):($("#query").prop("contenteditable",!0),hideGraph(),$("#grp-query-example").hide())}function getCredentialsFromLocalStorage(){if("true"==localStorage.getItem("hasCredentials")){var e=JSON.parse(localStorage.getItem("credentials"));$("#host").val(e.host),$("#port").val(e.port),$("#database").val(e.database),$("#username").val(e.username),$("#password").val(e.password),"true"==localStorage.getItem("showCredentials")?(showCredentialsPanel(),checkCredentialsForm()):showQueryPanel()}else"true"==localStorage.getItem("offlineMode")?showQueryPanel():console.log("No credentials in local storage.")}function setCredentialsInLocalStorage(){var e={host:$("#host").val(),port:$("#port").val(),database:$("#database").val(),username:$("#username").val(),password:$("#password").val()};localStorage.setItem("credentials",JSON.stringify(e)),localStorage.setItem("showCredentials",!1)}function checkInput(e){$("#"+e).val().length>0?$("#"+e).css("border","1px solid #28a745"):($("#"+e).css("border","1px solid #dc3545"),localStorage.setItem("credentialsError",!0))}function checkCredentialsForm(){"true"==localStorage.getItem("offlineMode")?localStorage.setItem("credentialsError",!1):(localStorage.setItem("credentialsError",!1),checkInput("host"),checkInput("port"),checkInput("database"),checkInput("username"),checkInput("password"))}function getCredentials(e,t,a){var c=e.split("=");3==c.length?a[t]=c[1]+c[2]:a[t]=c[1]}function updateCredentialsForm(){var e=JSON.parse(localStorage.getItem("credentials"));$("#host").val(e.host),$("#port").val(e.port),$("#database").val(e.database),$("#username").val(e.username),$("#password").val(e.password),localStorage.setItem("hasCredentials",!0)}function parsePSQLCmd(){var e=document.querySelector("#psql").value;return(e=e.split(" ")).forEach(getCredentials),{host:e[2],port:e[3],database:e[4],username:e[5],password:e[6]}}$(function(){init(),$("#query").blur(function(){var e=$(this).text();$(this).text(sqlFormatter.format(e,{language:"sql"})),highlight()}),$("#query-example").change(function(){if($("#queries-res").hide(),"-"!==$(this).val()){var e=parseInt($(this).val());$("#query").text(sqlFormatter.format(queryData[e].query,{language:"sql"})),highlight()}else $("#query").text("")}),$("#psql").change(function(e){if(""!==$("#psql").val()){var t=JSON.stringify(parsePSQLCmd());localStorage.setItem("credentials",t),updateCredentialsForm(),checkCredentialsForm()}else console.log("psql input empty")}),$("#form-submit").click(function(e){e.preventDefault(),checkCredentialsForm(),"true"==localStorage.getItem("credentialsError")?Swal.fire({title:"Invalid credentials",text:"Please verify your PSQL command or form input values",icon:"error",confirmButtonText:"OK"}):(setCredentialsInLocalStorage(),showQueryPanel())}),$("#config").click(function(e){e.preventDefault(),showCredentialsPanel()}),$("#executeQuery").click(function(e){e.preventDefault(),""===$("#query").text()?(Swal.fire({title:"Invalid query",text:"Please verify your SQL query",icon:"error",confirmButtonText:"OK"}),$("#query").css("border","1px solid #dc3545")):($("#query").css("border","1px solid #28a745"),executeQuery())}),$("#download-csv").click(function(){table.download("csv","query-data.csv")}),$("#download-json").click(function(){table.download("json","query-data.json")}),$("#download-xlsx").click(function(){table.download("xlsx","query-data.xlsx",{sheetName:"Query Service Data"})}),$("#download-pdf").click(function(){table.download("pdf","data.pdf",{orientation:"portrait",title:"Query Service Report",autoTable:{styles:{fillColor:[100,255,255]},columnStyles:{id:{fillColor:255}},margin:{top:60}}})}),$("#build-graph").click(function(){buildChart(generateChartConfig())}),$("#offline").click(function(){updateOfflineModeInput()}),$("#filter-field, #filter-type").change(updateFilter),$("#filter-value").keyup(updateFilter),$("#filter-clear").click(function(e){e.preventDefault(),$("#filter-field").val(""),$("#filter-type").val("="),$("#filter-value").val(""),table.clearFilter()}),$("#logo").click(function(){location.reload()})});